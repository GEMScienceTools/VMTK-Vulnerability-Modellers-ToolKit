# -*- coding: utf-8 -*-
"""
Created on Thu Oct 17 09:21:29 2019

@author: LuisMartins
"""

import numpy as np

# %%
def polylinear_curve_fit(x_array,y_array,n_pts=10):
      
      # This functon takes a generic curve and fits n linear segments through 
      # adaptive interpolation

      indices=np.array(np.round(np.linspace(0,np.size(y_array)-1,n_pts,endpoint=True),decimals=0),dtype=int)
      derivative_approx = np.diff(y_array[indices])
      inv_diff=1/np.abs(derivative_approx)
      weight_of_section=inv_diff/np.sum(inv_diff)
      
      total_range=np.max(x_array)-np.min(x_array)
      size_of_section=weight_of_section*total_range
      
      # fitted curve points
      x_array_fit=x_array[0]+(np.append(np.zeros([1]),np.cumsum(size_of_section)))
      y_array_fit=np.interp(x_array_fit,x_array,y_array)
      
      return x_array_fit,y_array_fit

#%%

cap_curve=np.loadtxt("C:/Users/LuisMartins/Desktop/cap_curves_py_test.csv",dtype=float,delimiter=',')
x_array_fit,y_array_fit=polylinear_curve_fit(cap_curve[:,0],cap_curve[:,1])
